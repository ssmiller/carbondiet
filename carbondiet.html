<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <link href="https://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <!-- Load c3.css -->
    <link href="static/c3-0.4.11/c3.css" rel="stylesheet" type="text/css">
    <!-- <link href="d3.slider.css" rel="stylesheet" type="text/css"> -->
    <link href="static/chartstyles.css" rel="stylesheet" type="text/css">

    <!-- Load d3.js and c3.js -->
    <script src="static/c3-0.4.11/c3.min.js"></script>
    <!--  <script src="d3.slider.js"></script> -->

    <!-- <link href="style.css" rel="stylesheet"> -->
    <body>
      <h1>Shrink Your Carbon Footprint -- Food Choices</h1>


      <div class = "col-md-12 exploration_text" id="text1">
        <h2>Food footprints</h2>

<p>A person’s food footprint (foodprint) is all the emissions that result from the production, transportation and storage of the food supplied to meet their consumption needs.  We chose to focus on food supply, rather than only food consumption, because a large proportion of food is lost at retail and consumer level.  Although emissions also occur when people transport, store and cook food, these emissions are omitted from our calculations as they are captured in travel and housing footprints.  For more information on travel and housing footprints, see <a href="www.shrinkthatfootprint.com">shrinkthatfoodprint.com</a>.  </p>

<p>Just like in any other analysis of food it makes sense to think of our food footprint in terms of different food groups. Using a combination of LCA and IO-LCA analysis together with average food consumption statistics we can estimate what a typical food footprint looks like. The average US food footprint is roughly 2.5 tons CO<sub>2</sub>equivalent (t CO<sub>2</sub>e). <a href="http://www.aashe.org/blog/what-does-one-ton-co2-really-mean">What does one ton of CO<sub>2</sub> really mean?</a> According to the <a href="https://www.epa.gov/energy/greenhouse-gas-equivalencies-calculator">EPA Calculator</a>, the average American foodprint is equal to the emissions of nearly 2700 pounds of coal burned, and it takes 2.4 acres of U.S. forests to sequester that amount of carbon in a year. The biggest sources of emissions are from the beef (0.8 t), dairy (0.5 t) and chicken (0.3 t) food groups.  This isn’t because these food groups dominate intake in the US diet, but rather that they are relatively carbon intensive to produce, in particular beef and dairy.</p>

<p>The remaining food footprint is reasonably well distributed across other groups like cereals, vegetables, fruit, oils, sugars and drinks.</p>

<p>Each of these diets are a variations on the average diet.  We assume the Meat Lover eats more red meat, white meat and dairy in place of some cereals, fruit and vegetables.  The No Beef option switches all beef consumption to the chicken group.  The Vegetarian switches away from beef and chicken to fruit and vegetables, while also reducing oils and snacks.  The Vegan does much the same as the vegetarian while also eliminating dairy through further switching to cereals, fruits and vegetables.  Despite all these changes 60% of food energy comes from exactly the same sources in all four diets of these diets.

<p> Note: Figures are based on total food supplied, so they include emissions from food consumed, losses, and spoilage.  Estimates based off 2005 data.</p>

<p></p>
      </div>

      <div class="container">


        <div class="row">
          <div class='col-md-12' >
            <div id="chart0"></div>
            <div class ='button'>
                  <button class='small' onclick='c0_all();'>Show All</button>
                </div>
          </div>
        </div>
      <!-- </div> -->


    <div class="row"><!--added in car, tet -->

      <div class = "col-md-12 exploration_text" id="text2">
        <p>Despite the fact that 60% of each of these diets are the same, the footprints vary greatly.  The ‘Average diet’ is based on the typical American diet and has a footprint of 2.5 t CO<sub>2</sub>equivalent per year.  The Meat Lover is 3.3 t, No Beef 1.9 t, the Vegetarian 1.7 t and the Vegan 1.5 t.</p>
        <p>Read more at <a href="http://shrinkthatfootprint.com/shrink-your-food-footprint">http://shrinkthatfootprint.com/shrink-your-food-footprint</a></p>

        
        <p>By making changes in our individual diets, we can reduce our carbon footprint! What would happen if you changed your diet for a year? Or for a few weeks?</p>

      </div>
    </div><!--added in car, tet -->

     <div class="row">  <!--added in car, tet -->
      <div class="col-md-4 diet_selector">
        <!-- <p><strong>Instructions: </strong><br> -->
        </p>
        <p>Choose your current diet: <p>
          Diet: <select id="dietselector1">
  
      <option value="meat">Meat Lover</option>
      <option value="average" selected>Average</option>
      <option value="nobeef">No Beef</option>
      <option value="vegetarian">Vegetarian</option>
      <option value="vegan">Vegan</option>
            </select>
      </div>

      <div class="col-md-8 diet_selector">
        <!-- <p><strong>Instructions: </strong><br> -->
        </p>
        <p>Choose a different diet and the number of weeks to try:<p>
          <!-- <select onchange = "getchoice2()" id="dietselector2"> -->
          <span>Diet:</span> <select id="dietselector2">
            <option value="meat">Meat Lover</option>
            <option value="average" selected>Average</option>
            <option value="nobeef">No Beef</option>
            <option value="vegetarian">Vegetarian</option>
            <option value="vegan">Vegan</option>
          </select>


<select id="weekselector">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">11</option>
  <option value="12">12</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
  <option value="16">16</option>
  <option value="17">17</option>
  <option value="18">18</option>
  <option value="19">19</option>
  <option value="20">20</option>
  <option value="21">21</option>
  <option value="22">22</option>
  <option value="23">23</option>
  <option value="24">24</option>
  <option value="25">25</option>
  <option value="26">26</option>
  <option value="27">27</option>
  <option value="28">28</option>
  <option value="29">29</option>
  <option value="30">30</option>
  <option value="31">31</option>
  <option value="32">32</option>
  <option value="33">33</option>
  <option value="34">34</option>
  <option value="35">35</option>
  <option value="36">36</option>
  <option value="37">37</option>
  <option value="38">38</option>
  <option value="39">39</option>
  <option value="40">40</option>
  <option value="41">41</option>
  <option value="42">42</option>
  <option value="43">43</option>
  <option value="44">44</option>
  <option value="45">45</option>
  <option value="46">46</option>
  <option value="47">47</option>
  <option value="48">48</option>
  <option value="49">49</option>
  <option value="50">50</option>
  <option value="51">51</option>
  <option value="52" selected>52</option>
</select>
<span>Weeks</span>
</div>

</div> <!--added in car, tet -->

      <!-- <div class="container"> removed in car, test-->
          <div class="row">
            <div class= "col-md-4" >
                <div id="chart1"></div>
                <div class ='button'>
                  <button class='small' onclick='c1_all();'>Show All</button>
                </div>
            </div>
            
            <div class= "col-md-4" >
              <p></p>
              <p></p>
              <p></p>
                <div id="chart2"></div>
                <div class ='button'>
                  <button class='small' onclick='c2_all();'>Show All</button>
                </div>
            </div>

            <div class= "col-md-4" >
                <div id="chart3"></div>
                <div class ='button'>
                  <button class='small' onclick='c3_breakdown();'>Show Breakdown</button>
                  <button class='small' onclick='c3_total();'>Show Total</button>
                  <button class='small' onclick='c3_all();'>Show Both</button>
                </div>
            </div>
        </div>

      <div class = "row"> <!--added in car, test -->

      <div class = "col-md-12 exploration_text" id="text3">
        <p>Because the majority of food supply emissions occur during production, changing your diet is the most effective way to shrink your footprint.  Reducing your consumption of beef, lamb and dairy products will have the largest effect, due to their high carbon intensity.  Additional reductions may also be found by limiting consumption of other meats and certain types of fruits.</p>

        <p>Trying to change your own diet habits is a pretty personal thing.  You may find it easy to reduce beef consumption but be addicted to cheese.  Generally though, there will always be a simple way to start.  You could try being vegetarian, or vegan, for a day at a time to see what you miss and what you don’t.  Between learning more and experimenting with your diet you may be able to make very large reductions that also benefit your health, and possibly your bank balance.</p>

        <p><em>Visualization created for SI 649 (UMich) Fall 2016 by Stephanie Miller.  Charts (estimated) based off figure comparing carbon footprint of five diets on <a href="http://shrinkthatfootprint.com/shrink-your-food-footprint">http://shrinkthatfootprint.com/shrink-your-food-footprint</a>. Text from same site.  There are many more factors that go into reducing your food footprint such as waste - and the referenced site analyzes them in detail. </em> </p>

      </div>
      </div>

    </div> <!--added in car, tet -->


      <script type="text/javascript">




    var foodgroups = ["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]
    var diets = ['foodgroup', 'Meat Lover', 'Average', 'No Beef', 'Vegetarian', 'Vegan']
    // var foodData = [
    //       ['x', 'Meat Lover', 'Average', 'No Beef', 'Vegetarian', 'Vegan'],
    //       ["Beef, lamb", 1.57, 0.77, 0.0, 0.0, 0.0 ],
    //       ["Chicken, fish, pork", 0.4, 0.34, 0.5, 0.0, 0.0],
    //       ["Dairy", 0.5, 0.46, 0.46, 0.4, 0.0],
    //       ["Cereals, breads", 0.2, 0.3, 0.3, 0.4,0.6],
    //       ["Vegetables", 0.1, 0.12, 0.12, 0.25, 0.3],
    //       ["Fruit", 0.1, 0.15, 0.15, 0.3, 0.3],
    //       ["Oils, spreads", 0.2, 0.18, 0.18, 0.18, 0.18],
    //       ["Snacks, sugar", 0.06, 0.06, 0.06, 0.06, 0.06],
    //       ["Drinks", 0.14, 0.14, 0.14, 0.14, 0.14]
    //       ]


    var meat = [
          ['x', "Meat Lover"],
          ["Beef, lamb", 1.57],
          ["Chicken, fish, pork", 0.4],
          ["Dairy", 0.6],
          ["Cereals, breads", 0.2],
          ["Vegetables",0.1],
          ["Fruit",0.1],
          ["Oils, spreads",0.18],
          ["Snacks, sugar",0.06],
          ["Drinks",0.14],
      ]

    var average = [
          ['x', "Average"],
          ["Beef, lamb", 0.77],
          ["Chicken, fish, pork", 0.34],
          ["Dairy", 0.46],
          ["Cereals, breads", 0.3],
          ["Vegetables",0.12],
          ["Fruit",0.15],
          ["Oils, spreads",0.18],
          ["Snacks, sugar",0.06],
          ["Drinks",0.14],   
      ]


      var nobeef = [

          ['x', "No Beef"],
          ["Beef, lamb", 0],
          ["Chicken, fish, pork", 0.5],
          ["Dairy", 0.46],
          ["Cereals, breads", 0.3],
          ["Vegetables",0.12],
          ["Fruit",0.15],
          ["Oils, spreads",0.18],
          ["Snacks, sugar",0.06],
          ["Drinks",0.14],
          // ["Total", 3.3]
      ]

      // var food4 = [
      var vegetarian = [
          ['x', "Vegetarian"],
          ["Beef, lamb", 0],
          ["Chicken, fish, pork", 0],
          ["Dairy", 0.4],
          ["Cereals, breads", 0.4],
          ["Vegetables",0.25],
          ["Fruit",0.3],
          ["Oils, spreads",0.12],
          ["Snacks, sugar",0.06],
          ["Drinks",0.14],
      ]

      var vegan = [
          ['x', "Vegan"],
          ["Beef, lamb", 0],
          ["Chicken, fish, pork", 0],
          ["Dairy", 0],
          ["Cereals, breads", 0.6],
          ["Vegetables",0.3],
          ["Fruit",0.3],
          ["Oils, spreads",0.12],
          ["Snacks, sugar",0.06],
          ["Drinks",0.14],
      ]

      var diettype = average;
      var newdiettype = average;


      function calculateCarbonSaved(olddiet, newdiet) {  //couldn't move this to the function area because it is called earlier
        saved = [] // empty array
        // console.log(saved);
        saved[0] = ["x","title"] // create the header array
        // console.log(saved);
        sum = 0;  //create a running total for the carbon savings
        // console.log(sum);

      for (i = 1 ; i < olddiet.length ; i++) { 
        saved[i] = []; // make a new array
        // console.log(saved);
        saved[i][0] = olddiet[i][0]; // save the first column (the name)
        // console.log(olddiet[i][0]);
        saved[i][1] = olddiet[i][1]-newdiet[i][1];  // subtract and save the second column (new value)
        sum += olddiet[i][1]-newdiet[i][1]; 
      // console.log(sum)
      } 
      // console.log(sum);
    saved[0][1] = "Carbon Savings by food type";
    saved[10] = [];
    saved[10][0] = "Total";
    saved[10][1] = sum;
      return saved;
  }

      carbonSaved = calculateCarbonSaved(diettype, newdiettype);


//////////  Chart Creation: All diets
    var chart0 = c3.generate({
title: {
  text: "Sample Diet Footprints"
},

  data: {
      x: 'x',
        
      columns: [
          ['x', 'Meat Lover', 'Average', 'No Beef', 'Vegetarian', 'Vegan'],
          ["Beef, lamb", 1.57, 0.77, 0.0, 0.0, 0.0  ],
          ["Chicken, fish, pork", 0.4, 0.34,0.5,0.0,0.0],
          ["Dairy", 0.6, 0.46, 0.46, 0.4, 0.0],
          ["Cereals, breads", 0.2, 0.3, 0.3, 0.4, 0.6],
          ["Vegetables", 0.1,0.12,0.12,0.25,0.3],
          ["Fruit", 0.1,0.15,0.15,0.3,0.3],
          ["Oils, spreads", 0.18, 0.18, 0.18, 0.12, 0.12],
          ["Snacks, sugar", 0.06, 0.06, 0.06, 0.06, 0.06],
          ["Drinks", 0.14, 0.14, 0.14, 0.14, 0.14]
      ],

      groups: [
            
            foodgroups
        ],
        order: null,
      type: 'bar',  

  

  },
  bar: {
        width: {
            ratio: 0.5 // this makes bar width 50% of length between ticks
          }
        },
  //http://stackoverflow.com/questions/32457291/how-to-format-number-in-d3-js-c3-js
  tooltip: {
        format: {
            value: function(value) {
                return d3.format(",.2f")(value)
            }
        },
        // grouped: false,
    },
  grid: {
        y: {
            lines: [
                {value: 0, text: '', position: 'middle'}
            ],
            // show: true,
        },
        x: {
          // show: true,
        },
    },
  axis: {
      x: {
          type: 'category',
      },
      y: {
        label: 
        {
          text: 't Carbon (CO2) equivalent / year',
          position: 'outer-middle',
        }
      }
  },
  padding: {  //https://github.com/c3js/c3/issues/219
    // left: 50,
    right: 10
  },
  bindto: '#chart0'
});


    //////// Current Diet.  Assumes Average as default, but can be changed by user
  var chart1 = c3.generate({
  title: {
  text: "Your Current Diet"

},

  data: {
      x: 'x',

      columns: diettype,  // need to update to change this variable based on the user selection
      groups: [
            
            foodgroups
        ],
      order: null,
      type: 'bar',


  },
  bar: {
        width: {
            ratio: 0.3 // this makes bar width 50% of length between ticks
          }
        },
  legend: {
          // position: 'right'
      },
  tooltip: {
        format: {
            value: function(value) {
                return d3.format(",.2f")(value)
            }
        },
        grouped: false,
    },
  grid: {
        x: {
          // show: true
        },
        y: {
            // show: true,
            lines: [
                {value: 0, text: '', position: 'middle'}
            ]
        }
    },
  axis: {
    y: {
       label: {
        text: 't Carbon (CO2) equivalent / year',
        position: 'outer-middle',
        
      },
      max: 3.5,
            min: 0,

       tick: {
        format: d3.format(",.2f")
       }
   },
      x: {
          // padding: {right: 1000000},
          type: 'category',
          tick: {
              // fit: true,
              format: '%Y',
              // culling: false,
          }
        }
      
  },
  padding: {  //https://github.com/c3js/c3/issues/219
    // left: 50,
    right: 10
  },
  bindto: '#chart1'
});


//////// Chart Creation:  New Diet 
var chart2 = c3.generate({
  title: {
  text: "Your New Diet"

},

  data: {
      x: 'x',

      columns: newdiettype,  // need to update to change this variable based on the user selection
      groups: [
            
            foodgroups
        ],
      order: null,
      type: 'bar',


  },
  bar: {
        width: {
            ratio: 0.3 // this makes bar width 50% of length between ticks
          }
        },
  legend: {
          // position: 'right'
      },
  tooltip: {
        format: {
            value: function(value) {
              return d3.format(",.2f")(value)
            },   
        },
        grouped: false,
    },
  grid: {
        x: {
          // show: true
        },
        y: {
            // show: true,
            lines: [
                {value: 0, text: '', position: 'middle'}
            ]
        }
    },
  axis: {
    y: {
       label: {
        text: 't Carbon (CO2) equivalent / year',
        position: 'outer-middle',
        
      },
      max: 3.5,
            min: 0,

       tick: {
        format: d3.format(",.2f")
       }
   },
      x: {
          // padding: {right: 1000000},
          type: 'category',
          tick: {
              // fit: true,
              format: '%Y',
              // culling: false,
          }
        }
      
  },
  padding: {  //https://github.com/c3js/c3/issues/219
    // left: 50,
    right: 10
  },
  bindto: '#chart2'
});

////////////  Chart3:  Carbon Savings
var chart3 = c3.generate({
  title: {
  text: "Carbon Savings"

},

  data: {
      x: 'x',

      columns: carbonSaved,  // need to update to change this variable based on the user selection
      order: null,
      type: 'bar',
      // labels: true,
      labels: {
        
        format:  {
            Total: d3.format('.2f'),  
            "Beef, lamb": d3.format('.2f'),
            "Chicken, fish, pork": d3.format('.2f'),
            "Dairy": d3.format('.2f'),
            "Cereals, breads": d3.format('.2f'),
            "Vegetables": d3.format('.2f'),
            "Fruit": d3.format('.2f'),
            "Oils, spreads": d3.format('.2f'),
            "Snacks, sugar": d3.format('.2f'),
            "Drinks": d3.format('.2f'),
            }
        }
},


  bar: {  // not sure if I can control this setting separately if showing only the total
        width: {
            ratio: 0.9 // this makes bar width 90% of length between ticks
          }
        },
  legend: {
          // position: 'right'
      },
  tooltip: {
        format: {
            value: function(value) {
                return d3.format(",.2f")(value)
            }
        },
        grouped: false,
    },
  grid: {
        x: {
          // show: true
        },
        y: {
            // show: true,
            lines: [
                {value: 0, text: '', position: 'middle'}
            ]
        }
    },
  axis: {
    y: {
       label: {
        text: 't Carbon (CO2) equivalent / year',
        position: 'outer-middle',

      },
max: 1.75,
            min: -1.75,
       tick: {
        format: d3.format(",.2f")
       }
   },
   // rotated: true,
      x: {
          // padding: {right: 1000000},
          type: 'category',
          tick: {
              // fit: true,
              format: '%Y',
              // culling: false,
          }
        }
      
  },
  padding: {  //https://github.com/c3js/c3/issues/219
    // left: 50,
    right: 10
  },
  bindto: '#chart3'
});


////////////  Functions



function c1_all() {
  chart1.show(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]);
}
function c2_all() {
  chart2.show(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]);
}

function c3_all() {
  chart3.show(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks", "Total"]);
}

function c3_breakdown() {
  chart3.show(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]);
  chart3.hide(["Total"]);
}

function c3_total() {
  chart3.hide(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]);
  chart3.show(["Total"]);
}


function c0_all() {
  chart0.show(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks", "Total"]);
}

function c6_breakdown() {
  chart3.show(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]);
  chart3.hide(["Total"]);
}

function c6_total() {
  chart3.hide(["Beef, lamb","Chicken, fish, pork","Dairy","Cereals, breads", "Vegetables","Fruit","Oils, spreads","Snacks, sugar","Drinks"]);
  chart3.show(["Total"]);
}


function calculateNewDiet(olddiet, newdiet, weeks) {
      console.log(olddiet);
      console.log(newdiet);
        combined = [] // empty array
        combined[0] = ["x","title"] // create the header array

      for (i = 1 ; i < olddiet.length ; i++) { 
        combined[i] = []; // make a new array
        combined[i][0] = olddiet[i][0]; // save the first column (the name)
        
        combined[i][1] = (1/52)*(52-weeks)*olddiet[i][1]+(1/52)*weeks*newdiet[i][1];  // add proportional amounts of each diet
      } 
    combined[0][1] = "Custom Combined Diet: "+ weeks + " weeks";
    console.log(combined);
      return combined;
  }





function updateCharts() {
        var foodSelection1 = eval($("#dietselector1").val());
        var foodSelection2 = eval($("#dietselector2").val());
        var nweeks = eval($("#weekselector").val());
        
        combinedDiet = calculateNewDiet(foodSelection1, foodSelection2, nweeks);

        chart1.load({
          columns: foodSelection1,
        });

        chart2.load({
                columns: combinedDiet,
            });
        chart3.load({
          columns: calculateCarbonSaved(foodSelection1, combinedDiet),
        });
}


//http://jsfiddle.net/km97cdL3/1/
//http://stackoverflow.com/questions/30163060/update-chart-using-based-on-dropdown-list
$("#dietselector1").change(function (evt) {

updateCharts(); 
});


$("#dietselector2").change(function (evt) {
        updateCharts(); 
});
        
        

$("#weekselector").change(function (evt) {
        updateCharts(); 
        });


</script>
    </body>
  </head>
</html>
